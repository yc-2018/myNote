## ==6.== JSONP夸域调用

> 你好！这是一个JSONP（JSON with Padding）跨域请求的示例。在这个例子中，你正在使用百度的搜索建议API。
>
> 首先，让我们分析这个URL：
>
> ```
> https://sp0.baidu.com/5a1Fazu8AA54nxGko9WTAnF6hhy/su?jsoncallback=jQuery18002568176207224737_1681129677419&wd=%E4%BD%A0%E5%B9%B2%E5%98%9B&cb=keydata&_=1681129959331
> ```
>
> 这个URL包含以下参数：
>
> - `jsoncallback`: 用于指定回调函数名称，这里的回调函数名称是`jQuery18002568176207224737_1681129677419`。
> - `wd`: 搜索词，这里是经过URL编码的“你干嘛”。
> - `cb`: 可选参数，可以自定义回调函数的参数名称。在这个例子中，回调函数的参数名称为`keydata`。
> - `_`: 时间戳，用于缓存防止。这个参数的值通常是当前时间的毫秒数。
>
> 这是一个简单的JSONP跨域请求示例。为了使这个例子完整，我将展示一个HTML页面，里面包含一个JavaScript代码片段，用于发起这个JSONP请求并处理返回的数据：
>
> ```html
> <!DOCTYPE html>
> <html lang="zh-CN">
> <head>
>     <meta charset="UTF-8">
>     <title>JSONP 跨域调用示例</title>
>     <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
> </head>
> <body>
>     <h1>搜索建议</h1>
>     <input type="text" id="search" placeholder="输入搜索词">
>     <ul id="suggestions"></ul>
>
>     <script>
>         //这个是报错修复方法
> 		function keydata(data) {
>             $('#suggestions').empty();
>             $.each(data.s, function(index, suggestion) {
>                 $('#suggestions').append('<li>' + suggestion + '</li>');
>             });
>         }
>
>         //GPT4 给的方法
>         $(document).ready(function() {
>             $('#search').on('input', function() {
>                 var searchWord = $(this).val();
>                 var url = 'https://sp0.baidu.com/5a1Fazu8AA54nxGko9WTAnF6hhy/su?jsoncallback=?&wd=' + encodeURIComponent(searchWord) + '&cb=keydata';
>
>                 $.getJSON(url, function(keydata) {
>                     $('#suggestions').empty();
>                     $.each(keydata.s, function(index, suggestion) {
>                         $('#suggestions').append('<li>' + suggestion + '</li>');
>                     });
>                 });
>             });
>         });
>     </script>
> </body>
> </html>
> ```
>
> 在这个例子中，当用户在文本框中输入搜索词时，页面将发送JSONP请求并处理返回的搜索建议数据。这是一个完整的JSONP跨域请求示例。
>
> **上面报错**（修复了）
>
> 在这个示例中,跨域服务器返回的 JSON 数据中带有一个 keydata callback 函数名,但是在当前页面这个函数未定义,所以报错 Uncaught ReferenceError: keydata is not defined。
>
> 修复方法很简单,我们只需要在页面中提前定义这个 callback 函数即可:
>
> ```html
> <script>
> function keydata(data) {
>     // Use data
> }
> </script>
> ```
>
> 这样,当跨域 JS 资源加载完毕,调用 keydata 函数时,就不会报错了。
>
> **==GPT3回答 JSONP夸域调用==**
>
> ```html
> <!DOCTYPE html>
> <html>
> <head>
>     <meta charset="UTF-8">
>     <title>JSONP Demo</title>
> </head>
> <body>
>   <p id="result"></p>
>
>   <script>
> 	  //Claude+修复bug方法
> 	  function keydata(data) {
>     handleResponse(data.s[0]);
>   }
> 	  //gpt3直接运行报错方法
>     function handleResponse(response) {
>       document.getElementById('result').textContent = response;
>     }
>
>     const script = document.createElement('script');
>     script.src = 'https://sp0.baidu.com/5a1Fazu8AA54nxGko9WTAnF6hhy/su?jsoncallback=jQuery18002568176207224737_1681129677419&wd=%E4%BD%A0%E5%B9%B2%E5%98%9B&cb=keydata&_=1681129959331';
>     document.body.appendChild(script);
>   </script>
> </body>
> </html>
> ```
>




