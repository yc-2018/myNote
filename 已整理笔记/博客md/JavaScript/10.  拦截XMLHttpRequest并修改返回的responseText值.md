## ==10.== 拦截XMLHttpRequest并修改返回的responseText值

> <kbd>2024.05.01</kbd> 参考：[JavaScript - 拦截XMLHttpRequest - wstong - 博客园](https://www.cnblogs.com/wstong2052/p/17487141.html)
>
> ---
>
> 拦截`XMLHttpRequest`没法直接修改`responseText`，因为他是只读的,所以要用下面的办法来更改`responseText`的get方法
>
> **方法1**
>
> ```js
> var accessor = Object.getOwnPropertyDescriptor(XMLHttpRequest.prototype, 'responseText');
> Object.defineProperty(XMLHttpRequest.prototype, 'responseText', {
>     get: function() {
>         let res = accessor.get.call(this);
>         // 在这里对res值进行修改
>         console.log(res);
>         return res;
>     },
>     set: function(str) {
>         console.log('set responseText: %s', str);
>         // return accessor.set.call(this, str);
>     },
>     configurable: true
> });
> ```
>
> ---
>
> **方法2**
>
> ```js
> function setupHook(xhr) {
>     function getter() {
>         console.log('get responseText');
>         delete xhr.responseText;  // 不delete将造成递归
>         var res = xhr.responseText;
>         // 在这改 res
>         setup(); // 重新安装 getter 和 setter
>         return res;
>     }
>     function setter(str) {
>         console.log('set response: %s', str);
>     }
>     function setup() {
>         Object.defineProperty(xhr, 'responseText', {
>             get: getter,
>             set: setter,
>             configurable: true
>         });
>     }
>     setup();
> }
>
> var oldOpen = XMLHttpRequest.prototype.open;
> XMLHttpRequest.prototype.open = function(method, url, async, user, password) {
>     if (!this._hooked) {
>         this._hooked = true;
>         setupHook(this);
>     }
>     oldOpen.apply(this, arguments);
> }
> ```




